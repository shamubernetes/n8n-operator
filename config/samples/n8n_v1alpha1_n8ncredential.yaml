# Example 1: Credential from a Kubernetes Secret
# The Secret can be managed by External Secrets Operator for any backend
apiVersion: n8n.n8n.io/v1alpha1
kind: N8nCredential
metadata:
  name: postgres-account
  namespace: services
spec:
  n8nInstance:
    url: http://n8n.services.svc:5678
    apiKeySecretRef:
      name: n8n-api-key
      key: api-key
  credentialName: "Postgres account"
  credentialType: postgres
  secretRef:
    name: postgres-credentials  # Can be an ExternalSecret target
  fieldMappings:
    # Maps n8n field -> Secret key
    host: POSTGRES_HOST
    user: POSTGRES_USER
    password: POSTGRES_PASSWORD
    database: POSTGRES_DATABASE
  data:
    # Static values that don't need to be in a secret
    port: "5432"
    ssl: "disable"
    sshAuthenticateWith: "password"
    sshHost: ""
    sshPort: "22"
    sshUser: ""
    sshPassword: ""
    privateKey: ""
    passphrase: ""
---
# Example 2: HTTP Header Auth (e.g., for webhooks)
apiVersion: n8n.n8n.io/v1alpha1
kind: N8nCredential
metadata:
  name: webhook-auth
  namespace: services
spec:
  n8nInstance:
    url: http://n8n.services.svc:5678
    apiKeySecretRef:
      name: n8n-api-key
      key: api-key
  credentialName: "Webhook Auth"
  credentialType: httpHeaderAuth
  secretRef:
    name: webhook-token
  fieldMappings:
    value: token
  data:
    name: "Authorization"
---
# Example 3: Using ServiceRef instead of URL
apiVersion: n8n.n8n.io/v1alpha1
kind: N8nCredential
metadata:
  name: smtp-credential
  namespace: services
spec:
  n8nInstance:
    serviceRef:
      name: n8n
      namespace: services
      port: 5678
    apiKeySecretRef:
      name: n8n-api-key
      key: api-key
  credentialName: "SMTP Server"
  credentialType: smtp
  secretRef:
    name: smtp-credentials
  fieldMappings:
    user: SMTP_USER
    password: SMTP_PASSWORD
  data:
    host: "smtp.example.com"
    port: "587"
    secure: "true"
